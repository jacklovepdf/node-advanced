window.electron = require('electron');
var ipcRenderer = electron && electron.ipcRenderer;
var channel = 'webviewJssdk'

function init(eventName, callback) {
    ipcRenderer.on(eventName, function (event, arg) {
        callback(arg);
    });
}

//发送消息到host页面的webview元素
function sendToRender(signalName, params) {
    ipcRenderer.sendToHost(signalName, params);
}

window.webkit = {
    messageHandlers: {
        publish: {
            postMessage: function (args) {
                sendToRender(channel, args);
            }
        }
    }
}

init(channel, function (oEvent) {
    let msg = "invokeMiniProgramAPI:";
    oEvent.isSuccess === true ? msg += "ok" : msg +="fail" 
    global.ttJSBridge.subscribeHandler(oEvent.event, {        
        data: {
            res: {
                errMsg: msg
            },
            callbackId: oEvent.callbackId,
            isSuccess: oEvent.isSuccess
        }
    })
})

window.__ttjsenv__ = 'microapp'